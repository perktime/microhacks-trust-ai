name: ai-foundry
# metadata:
#   template: ai-foundry@0.0.1
infra:
  provider: bicep
  path: infra

hooks:
  postprovision:
    shell: sh
    run: |
      echo "=============================================="
      echo "POST-PROVISION HOOKS STARTED"
      echo "=============================================="
      echo "Timestamp: $(date)"
      echo ""
      
      cd scripts
      
      echo "----------------------------------------------"
      echo "STEP 1: Uploading data to Azure AI Search"
      echo "----------------------------------------------"
      echo "Starting: $(date)"
      python 01_upload_data_to_search.py
      if [ $? -eq 0 ]; then
        echo "âœ“ Step 1 completed successfully at $(date)"
      else
        echo "âœ— Step 1 failed at $(date)"
        exit 1
      fi
      echo ""
      
      echo "----------------------------------------------"
      echo "STEP 2: Deploying Container Apps"
      echo "----------------------------------------------"
      echo "Starting: $(date)"
      ./02_deploy_container_apps.sh
      if [ $? -eq 0 ]; then
        echo "âœ“ Step 2 completed successfully at $(date)"
      else
        echo "âœ— Step 2 failed at $(date)"
        exit 1
      fi
      echo ""
      
      echo "=============================================="
      echo "POST-PROVISION HOOKS COMPLETED"
      echo "Finished at: $(date)"
      echo "=============================================="
      echo ""
      APP_URL=$(az containerapp show --name "$AZURE_CONTAINER_APP_NAME" --resource-group "$AZURE_RESOURCE_GROUP" --query "properties.configuration.ingress.fqdn" -o tsv)
      echo "ðŸš€ Application URL: https://$APP_URL"
      echo ""
